# æ™ºèƒ½è´¦å•ç®¡ç†ç³»ç»Ÿ (Smart Bill Manager)

ä¸€ä¸ªç°ä»£åŒ–çš„ä¸ªäººè´¦å•ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒæ”¯ä»˜è®°å½•ç®¡ç†ã€å‘ç¥¨è‡ªåŠ¨è§£æå’Œé‚®ç®±å®æ—¶ç›‘æ§ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ” ç”¨æˆ·è®¤è¯
- JWTä»¤ç‰Œè®¤è¯
- å®‰å…¨çš„å¯†ç åŠ å¯†å­˜å‚¨
- é¦–æ¬¡å¯åŠ¨é€šè¿‡ Setup é¡µé¢å®Œæˆåˆå§‹åŒ–
- APIè¯·æ±‚é¢‘ç‡é™åˆ¶

### ğŸ“Š ä»ªè¡¨ç›˜
- æœ¬æœˆæ”¯å‡ºæ€»è§ˆ
- æ¯æ—¥æ”¯å‡ºè¶‹åŠ¿å›¾
- æ”¯å‡ºåˆ†ç±»é¥¼å›¾
- é‚®ç®±ç›‘æ§çŠ¶æ€
- æœ€è¿‘é‚®ä»¶è®°å½•

### ğŸ’° æ”¯ä»˜è®°å½•ç®¡ç†
- æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤æ”¯ä»˜è®°å½•
- æŒ‰æ—¥æœŸã€åˆ†ç±»ç­›é€‰
- æ”¯å‡ºç»Ÿè®¡åˆ†æ
- æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼åˆ†ç±»
- **ğŸ†• æ”¯ä»˜æˆªå›¾ä¸Šä¼ å’Œè‡ªåŠ¨è¯†åˆ«** âœ¨
  - ä¸Šä¼ å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®ã€é“¶è¡Œè½¬è´¦æˆªå›¾
  - è‡ªåŠ¨è¯†åˆ«é‡‘é¢ã€å•†å®¶ã€äº¤æ˜“æ—¶é—´ã€æ”¯ä»˜æ–¹å¼
  - è‹¥æ— æ³•è¯†åˆ«äº¤æ˜“æ—¶é—´ï¼šä¸Šä¼ ä»ä¼šæˆåŠŸï¼Œä½†éœ€è¦ä½ æ‰‹åŠ¨é€‰æ‹©äº¤æ˜“æ—¶é—´åå†ä¿å­˜ï¼ˆé¿å…é”™è¯¯å½’å±/ç»Ÿè®¡ï¼‰
  - ä¸Šä¼ åè¿›å…¥â€œå¯ç¼–è¾‘ç¡®è®¤é¡µâ€ï¼Œç‚¹å‡»ä¿å­˜æ‰ä¼šå˜æˆæ­£å¼è®°å½•ï¼ˆè‰ç¨¿ä¸ä¼šå‡ºç°åœ¨åˆ—è¡¨/ç»Ÿè®¡ä¸­ï¼‰
  - æ”¯æŒæŸ¥çœ‹ OCR åŸå§‹æ–‡æœ¬/æ•´ç†æ–‡æœ¬ï¼Œä¾¿äºä½ æ ¡å¯¹ä¸ä¿®æ­£
  - OCRæŠ€æœ¯æ”¯æŒä¸­è‹±æ–‡è¯†åˆ«

### ğŸ—“ï¸ è¡Œç¨‹ / å·®æ—…æ—¥å†
- åˆ›å»ºè¡Œç¨‹ï¼ˆå¼€å§‹/ç»“æŸæ—¶é—´ç²¾ç¡®åˆ°ç§’ï¼Œå¯é€‰æ‹©æ—¶åŒºï¼‰
- è¡Œç¨‹å†…æ¶ˆè´¹ç»Ÿè®¡ï¼ˆä»¥æ”¯ä»˜æ—¶é—´ä¸ºå‡†ï¼‰
- è‡ªåŠ¨å½’å±ï¼šæ”¯ä»˜æ—¶é—´å”¯ä¸€å‘½ä¸­è¡Œç¨‹ â†’ è‡ªåŠ¨å½’å±
- è¡Œç¨‹é‡å ï¼šè‡ªåŠ¨å½’å±çš„æ”¯ä»˜è¿›å…¥â€œå¾…å¤„ç†â€ï¼Œåœ¨è¡Œç¨‹é¡µæ‰‹åŠ¨é€‰æ‹©å½’å±æˆ–ä¿æŒæ— å½’å±ï¼ˆæ‰‹åŠ¨å½’å±ä¸ä¼šè¢«è‡ªåŠ¨æ‰“å›ï¼‰
- è¡Œç¨‹å˜æ›´ï¼ˆæ–°å»º/ä¿®æ”¹/åˆ é™¤ï¼‰ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—å½’å±ï¼Œå¹¶æç¤ºå½’å±å˜åŒ–æ•°é‡
- æ”¯æŒå•ç¬”æ”¯ä»˜ç§»å‡ºè¡Œç¨‹ / ç§»åŠ¨åˆ°å…¶ä»–è¡Œç¨‹
- åˆ é™¤è¡Œç¨‹ï¼šä»…åˆ é™¤å½’å±åˆ°è¯¥è¡Œç¨‹çš„æ”¯ä»˜è®°å½•ï¼Œå¹¶æŒ‰å…³è”å…³ç³»åˆ é™¤/è§£ç»‘å‘ç¥¨ï¼ˆå¸¦é¢„è§ˆç¡®è®¤ï¼‰

### ğŸ“„ å‘ç¥¨ç®¡ç†
- PDF/å›¾ç‰‡å‘ç¥¨ä¸Šä¼ ï¼ˆæ”¯æŒæ‰¹é‡ï¼ŒPNG/JPGï¼‰
- **ğŸ†• æ™ºèƒ½å‘ç¥¨è¯†åˆ«** âœ¨
  - è‡ªåŠ¨è§£æå‘ç¥¨å·ç ã€é‡‘é¢ã€ç¨é¢ã€é”€å”®æ–¹ã€è´­ä¹°æ–¹
  - æ”¯æŒå¢å€¼ç¨ç”µå­æ™®é€šå‘ç¥¨ã€å¢å€¼ç¨ç”µå­ä¸“ç”¨å‘ç¥¨
  - ä½¿ç”¨ä¸“ä¸šPDFè§£æåº“å’ŒOCRæŠ€æœ¯
- ä¸Šä¼ åè¿›å…¥â€œå¯ç¼–è¾‘ç¡®è®¤é¡µâ€ï¼Œç‚¹å‡»ä¿å­˜æ‰ä¼šå˜æˆæ­£å¼è®°å½•ï¼ˆè‰ç¨¿ä¸ä¼šå‡ºç°åœ¨åˆ—è¡¨/ç»Ÿè®¡ä¸­ï¼‰
- æ”¯æŒæŸ¥çœ‹ OCR åŸå§‹æ–‡æœ¬ï¼ˆç”¨äºæ’æŸ¥â€œå†…å®¹è¯†åˆ«å¯¹ä½†æŠ½å–é”™â€ç­‰é—®é¢˜ï¼‰
- å‘ç¥¨é¢„è§ˆå’Œä¸‹è½½
- æ¥æºè¿½è¸ªï¼ˆæ‰‹åŠ¨ä¸Šä¼ /é‚®ä»¶ä¸‹è½½ï¼‰
- **ğŸ†• å‘ç¥¨ä¸æ”¯ä»˜è®°å½•å…³è”** âœ¨
  - æ‰‹åŠ¨å…³è”å‘ç¥¨åˆ°æ”¯ä»˜è®°å½•
  - 1:1 çº¦æŸï¼šä¸€ç¬”æ”¯ä»˜æœ€å¤šå…³è”ä¸€å¼ å‘ç¥¨ï¼Œä¸”ä¸€å¼ å‘ç¥¨æœ€å¤šå…³è”ä¸€ç¬”æ”¯ä»˜
  - æ™ºèƒ½åŒ¹é…å»ºè®®ï¼ˆåŸºäºé‡‘é¢å’Œæ—¥æœŸï¼‰
  - æŸ¥çœ‹å…³è”å…³ç³»

### ğŸ“¬ é‚®ç®±ç›‘æ§
- **æ”¯æŒQQé‚®ç®±** âœ…
- æ”¯æŒ163ã€126ã€Gmailã€Outlookç­‰ä¸»æµé‚®ç®±
- å®æ—¶ç›‘æ§æ–°é‚®ä»¶
- è‡ªåŠ¨ä¸‹è½½PDFé™„ä»¶
- æ‰‹åŠ¨æ£€æŸ¥æ–°é‚®ä»¶

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯
- Go 1.24 (Gin Webæ¡†æ¶)
- SQLite (GORM ORM)
- JWTè®¤è¯ (golang-jwt/jwt)
- golang.org/x/crypto/bcrypt (å¯†ç åŠ å¯†)
- emersion/go-imap (é‚®ç®±IMAPåè®®)
- **ğŸ†• RapidOCR v3**ï¼ˆOCRè¯†åˆ«å¼•æ“ï¼ŒPython + ONNXRuntimeï¼‰âœ¨
- **ğŸ†• PyMuPDF**ï¼ˆPDF æ–‡æœ¬æå–/é¢„å¤„ç†ï¼Œå¤±è´¥åˆ™å›é€€åˆ° OCRï¼‰âœ¨
- **ğŸ†• poppler-utils**ï¼ˆ`pdftoppm`/`pdftotext`ï¼Œç”¨äº PDFâ†’å›¾ç‰‡ ä¸ æ–‡æœ¬æå–ï¼‰âœ¨
- gin-contrib/cors (CORSæ”¯æŒ)
- å†…ç½®è¯·æ±‚é¢‘ç‡é™åˆ¶

### å‰ç«¯
- Vue 3 + TypeScript + Composition API
- Vite (æ„å»ºå·¥å…·)
- PrimeVue + PrimeFlex + PrimeIcons (UIç»„ä»¶/å¸ƒå±€/å›¾æ ‡)
- ECharts / Vue-ECharts (å›¾è¡¨)
- Vue Router (è·¯ç”±)
- Pinia (çŠ¶æ€ç®¡ç†)
- Axios (HTTPå®¢æˆ·ç«¯)

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨é¢„æ„å»ºé•œåƒï¼ˆæœ€ç®€å•ï¼‰

ç›´æ¥ä» GitHub Container Registry æ‹‰å–é¢„æ„å»ºçš„ Docker é•œåƒï¼Œæ— éœ€å…‹éš†ä»£ç ã€‚

```bash
# æ‹‰å–æœ€æ–°é•œåƒ
docker pull ghcr.io/tuoro/smart-bill-manager:latest

# è¿è¡Œå®¹å™¨
docker run -d \
  --name smart-bill-manager \
  -p 80:80 \
  -v smart-bill-data:/app/backend/data \
  -v smart-bill-uploads:/app/backend/uploads \
  ghcr.io/tuoro/smart-bill-manager:latest
```

è®¿é—® http://localhost å³å¯ä½¿ç”¨ã€‚

### æ–¹å¼äºŒï¼šDocker Compose éƒ¨ç½²ï¼ˆæ¨èï¼‰

ä½¿ç”¨ Docker Compose å¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†å®¹å™¨å’Œæ•°æ®å·ã€‚

#### ç¯å¢ƒè¦æ±‚
- Docker >= 20.10
- Docker Compose >= 2.0

#### éƒ¨ç½²æ­¥éª¤

1. **åˆ›å»º docker-compose.yml æ–‡ä»¶**
```yaml
services:
  smart-bill-manager:
    image: ghcr.io/tuoro/smart-bill-manager:latest
    container_name: smart-bill-manager
    restart: unless-stopped
    ports:
      - "80:80"
    environment:
      - JWT_SECRET=your-secure-secret-key-here  # å¯é€‰ï¼šè®¾ç½®JWTå¯†é’¥
      - ADMIN_PASSWORD=your-admin-password      # å¯é€‰ï¼šè®¾ç½®ç®¡ç†å‘˜å¯†ç 
    volumes:
      - app-data:/app/backend/data
      - app-uploads:/app/backend/uploads

volumes:
  app-data:
  app-uploads:
```

2. **å¯åŠ¨æœåŠ¡**
```bash
docker-compose up -d
```

3. **é¦–æ¬¡è®¿é—®**
- æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost
- é¦–æ¬¡è®¿é—®ä¼šè‡ªåŠ¨è¿›å…¥åˆå§‹åŒ–è®¾ç½®é¡µé¢
- åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š
  - è¾“å…¥ç®¡ç†å‘˜ç”¨æˆ·åï¼ˆ3-50å­—ç¬¦ï¼‰
  - è®¾ç½®å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰
  - å¯é€‰å¡«å†™é‚®ç®±åœ°å€
- åˆ›å»ºåå°†è‡ªåŠ¨ç™»å½•åˆ°ç³»ç»Ÿ

4. **æŸ¥çœ‹æ—¥å¿—**
```bash
docker-compose logs -f
```

5. **åœæ­¢æœåŠ¡**
```bash
docker-compose down
```

6. **æ•°æ®æŒä¹…åŒ–**
æ•°æ®åº“å’Œä¸Šä¼ æ–‡ä»¶å­˜å‚¨åœ¨ Docker å·ä¸­ï¼š
- `app-data`: æ•°æ®åº“æ–‡ä»¶
- `app-uploads`: ä¸Šä¼ çš„æ–‡ä»¶
  
RapidOCR çš„æ¨¡å‹ç¼“å­˜ä¹Ÿå»ºè®®æŒä¹…åŒ–ï¼ˆå¦åˆ™æ¯æ¬¡é‡å»º/é‡å¯å¯èƒ½éœ€è¦é‡æ–°ä¸‹è½½æ¨¡å‹ï¼‰ï¼š
- å·²åœ¨ `docker-compose.yml` é»˜è®¤è®¾ç½® `SBM_OCR_DATA_DIR=/app/backend/data`ï¼Œæ¨¡å‹å°†ä¿å­˜åˆ° `app-data` å·å†…çš„ `/app/backend/data/rapidocr-models/`

#### ä¸Šä¼ æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸï¼ˆè‰ç¨¿ï¼‰

- ä¸Šä¼ æ”¯ä»˜æˆªå›¾/å‘ç¥¨ä¼šå…ˆåˆ›å»º `is_draft=true` çš„è‰ç¨¿è®°å½•ï¼šä¸ä¼šè¿›å…¥åˆ—è¡¨/ç»Ÿè®¡ï¼Œä¹Ÿä¸ä¼šå½±å“è¡Œç¨‹å½’å±ä¸åŒ¹é…ã€‚
- ç‚¹å‡»ä¿å­˜ï¼ˆ`confirm=true`ï¼‰åæ‰å˜æˆæ­£å¼è®°å½•ï¼šæ–‡ä»¶è·¯å¾„ä¸å˜ï¼Œä¸ä¼šç§»åŠ¨/æ”¹åã€‚
- ç‚¹å‡»å–æ¶ˆ/å…³é—­å¼¹çª—ä¼šåˆ é™¤è‰ç¨¿è®°å½•å¹¶åˆ é™¤ä¸Šä¼ æ–‡ä»¶ï¼›åˆ·æ–°/å´©æºƒå¯¼è‡´çš„æ®‹ç•™è‰ç¨¿ä¼šåœ¨å‰ç«¯/åç«¯è‡ªåŠ¨æ¸…ç†ã€‚
- å¯ç”¨ç¯å¢ƒå˜é‡ï¼ˆåç«¯ï¼‰ï¼š
  - `UPLOADS_DIR=./uploads`ï¼ˆä¸Šä¼ ç›®å½•ï¼Œå®¹å™¨å†…é»˜è®¤ `/app/backend/uploads`ï¼‰
  - `SBM_DRAFT_TTL_HOURS=6`ï¼ˆè‰ç¨¿è¶…æ—¶è‡ªåŠ¨æ¸…ç†é˜ˆå€¼ï¼‰
  - `SBM_DRAFT_CLEANUP_INTERVAL_MINUTES=15`ï¼ˆè‰ç¨¿æ¸…ç†ä»»åŠ¡çš„è½®è¯¢é—´éš”ï¼‰

#### é‡å¤æ–‡ä»¶å¤„ç†ï¼ˆå»é‡ï¼‰

- å¼ºæ‹’ç»ï¼šä¸Šä¼ æ—¶å¯¹æ–‡ä»¶è®¡ç®— `SHA-256`ï¼›è‹¥å“ˆå¸Œå·²å­˜åœ¨ï¼ˆè‰ç¨¿æˆ–å·²ä¿å­˜ï¼‰ï¼Œæ¥å£è¿”å› `409` å¹¶ç»™å‡ºå·²æœ‰è®°å½• `id`ã€‚
- ç–‘ä¼¼é‡å¤ï¼ˆå¯å¼ºåˆ¶ä¿å­˜ï¼‰ï¼š
  - å‘ç¥¨ï¼šä»¥ `invoice_number`ï¼ˆå‘ç¥¨å·ç ï¼‰ä¸ºä¸»é”®åšç–‘ä¼¼é‡å¤åˆ¤æ–­ï¼›ä¿å­˜æ—¶ä¼šæç¤ºï¼Œç¡®è®¤â€œä»ç„¶ä¿å­˜â€æ‰ä¼šè½åº“ä¸ºæ­£å¼è®°å½•ã€‚
  - æ”¯ä»˜æˆªå›¾ï¼šä»¥â€œé‡‘é¢ + äº¤æ˜“æ—¶é—´ï¼ˆé‚»è¿‘çª—å£ï¼‰â€åšç–‘ä¼¼é‡å¤åˆ¤æ–­ï¼›ä¿å­˜æ—¶ä¼šæç¤ºï¼Œç¡®è®¤â€œä»ç„¶ä¿å­˜â€æ‰ä¼šè½åº“ä¸ºæ­£å¼è®°å½•ã€‚
- APIï¼š`PUT /api/invoices/:id` / `PUT /api/payments/:id` åœ¨ `confirm=true` æ—¶å¯ä¼  `force_duplicate_save=true` è¿›è¡Œå¼ºåˆ¶ä¿å­˜ï¼ˆä»…å¯¹â€œç–‘ä¼¼é‡å¤â€ç”Ÿæ•ˆï¼›å“ˆå¸Œé‡å¤ä¸å…è®¸å¼ºåˆ¶ï¼‰ã€‚

#### OCRï¼ˆRapidOCR v3ï¼ŒCPUï¼‰

é»˜è®¤ä½¿ç”¨ `RapidOCR v3 + onnxruntime` åœ¨ CPU ä¸Šè¿›è¡Œè¯†åˆ«ï¼Œä½¿ç”¨ RapidOCR çš„**å†…ç½®é»˜è®¤æ¨¡å‹/é…ç½®**ã€‚

å‘ç¥¨è¯†åˆ«æ”¯æŒ **PDF/å›¾ç‰‡**ï¼š
- PDFï¼šä¼˜å…ˆä½¿ç”¨ PyMuPDF æå–å†…åµŒæ–‡æœ¬ï¼ˆå¤±è´¥å†èµ° RapidOCRï¼‰
- å›¾ç‰‡ï¼ˆPNG/JPGï¼‰ï¼šç›´æ¥ä½¿ç”¨ RapidOCR v3

æ”¯ä»˜æˆªå›¾ï¼ˆå¾®ä¿¡/æ”¯ä»˜å®ç­‰è´¦å•è¯¦æƒ…ç±»é¡µé¢ï¼‰ï¼šä¼šåšä¸€æ¬¡å¸ƒå±€æ„ŸçŸ¥åå¤„ç†ï¼ŒæŠŠâ€œæ ‡ç­¾åˆ—/å€¼åˆ—â€çš„ OCR è¾“å‡ºåˆå¹¶æˆæ›´ç¨³å®šçš„ `æ ‡ç­¾ï¼šå€¼` æ–‡æœ¬ï¼Œæå‡å­—æ®µæå–ç¨³å®šæ€§ã€‚

å¯ç”¨ç¯å¢ƒå˜é‡ï¼š
- `SBM_OCR_ENGINE=rapidocr`ï¼ˆé»˜è®¤ï¼‰
- `SBM_OCR_DATA_DIR=/app/backend/data`ï¼ˆæ¨èï¼›ç”¨äºæŠŠ RapidOCR è‡ªåŠ¨ä¸‹è½½çš„æ¨¡å‹ç¼“å­˜åˆ°å¯æŒä¹…åŒ–ç›®å½•ï¼Œä¾¿äºå®¹å™¨é‡å¯åå¤ç”¨ï¼›æ¨¡å‹ä¼šå†™å…¥ `$SBM_OCR_DATA_DIR/rapidocr-models/`ï¼‰
- `SBM_PDF_TEXT_EXTRACTOR=pymupdf|off`ï¼ˆé»˜è®¤ `pymupdf`ï¼šä¼˜å…ˆç”¨ PyMuPDF æå– PDF å†…åµŒæ–‡æœ¬ï¼›å¤±è´¥å†èµ° OCRï¼‰
- `SBM_PDF_OCR_DPI=220`ï¼ˆå¯é€‰ï¼ŒèŒƒå›´å»ºè®® `120-450`ï¼›æ›´é«˜æ›´æ¸…æ™°ä½†æ›´æ…¢ï¼‰
- `SBM_RAPIDOCR_MULTIPASS=1`ï¼ˆå¯é€‰ï¼›å¯¹ `profile=pdf` é»˜è®¤å¯ç”¨ï¼Œç”¨å¤šç§å¢å¼ºç‰ˆæœ¬é€‰æœ€ä¼˜ç»“æœï¼‰
- `SBM_RAPIDOCR_ROTATE180=true`ï¼ˆå¯é€‰ï¼›å¯¹ `profile=pdf` é»˜è®¤å¯ç”¨ï¼Œå…¼å®¹å€’ç½®æ‰«æï¼‰
- `SBM_OCR_DEBUG=true`ï¼ˆå¯é€‰ï¼›è¿”å›æ›´å¤š OCR å˜ä½“è¯„åˆ†ä¿¡æ¯ï¼Œä¾¿äºæ’æŸ¥ï¼‰


#### å‘ç¥¨è´­é”€æ–¹ ROIï¼ˆå¯é€‰ï¼‰

é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘ç¥¨ PDF è§£æä¼šå¯¹ **æ•´é¡µå›¾ç‰‡** åš OCRï¼Œå¹¶ä»…æ³¨å…¥äºŒç»´ç å¯ç¨³å®šæå–çš„æŠ¬å¤´å­—æ®µï¼ˆå¦‚å‘ç¥¨ä»£ç /å·ç /æ—¥æœŸ/ä»·ç¨åˆè®¡ï¼‰ã€‚

å¦‚æœä½ å¸Œæœ›é¢å¤–å¯ç”¨â€œè´­ä¹°æ–¹/é”€å”®æ–¹â€åŒºåŸŸ ROI è¯†åˆ«ï¼ˆå¯èƒ½æå‡ï¼Œä¹Ÿå¯èƒ½å› ä¸ºæ³¨å…¥ç‰‡æ®µå¯¼è‡´è§£æå—å¹²æ‰°ï¼‰ï¼Œå¯è®¾ç½®ï¼š
- `SBM_INVOICE_PARTY_ROI=auto|true|false`ï¼ˆé»˜è®¤ `auto`ï¼šä»…åœ¨ä¸» OCR æœªèƒ½è¯†åˆ«è´­é”€æ–¹æ—¶å†å°è¯• ROIï¼‰

### æ–¹å¼ä¸‰ï¼šä»æºç æ„å»º

å¦‚æœéœ€è¦è‡ªå®šä¹‰æˆ–å¼€å‘ï¼Œå¯ä»¥ä»æºç æ„å»ºé•œåƒã€‚

1. **å…‹éš†ä»“åº“**
```bash
git clone https://github.com/tuoro/Smart-bill-manager.git
cd Smart-bill-manager
```

2. **æ„å»ºå¹¶å¯åŠ¨**
```bash
docker-compose up -d --build
```

æˆ–è€…å•ç‹¬æ„å»ºé•œåƒï¼š

```bash
# æ„å»ºé•œåƒ
docker build -t smart-bill-manager .

# è¿è¡Œå®¹å™¨
  docker run -d \
  --name smart-bill-manager \
  -p 80:80 \
  -e SBM_OCR_DATA_DIR=/app/backend/data \
  -v smart-bill-data:/app/backend/data \
  -v smart-bill-uploads:/app/backend/uploads \
  smart-bill-manager
```

### æ–¹å¼å››ï¼šæœ¬åœ°å¼€å‘

#### ç¯å¢ƒè¦æ±‚
- Go >= 1.21
- Node.js >= 18
- npm >= 8
- RapidOCR v3 (ç”¨äºå›¾ç‰‡æ–‡å­—è¯†åˆ«ï¼ŒPython + ONNXRuntime)
- poppler-utils (ç”¨äºPDFæ–‡æœ¬æå–ï¼Œæ”¯æŒCIDå­—ä½“)

å®‰è£…ç³»ç»Ÿä¾èµ–ï¼š
```bash
# Ubuntu/Debian
sudo apt-get install poppler-utils python3 python3-pip
python3 -m pip install "rapidocr==3.*" onnxruntime

# macOS
brew install poppler python
python3 -m pip install "rapidocr==3.*" onnxruntime
```

#### å®‰è£…æ­¥éª¤

1. **å…‹éš†ä»“åº“**
```bash
git clone https://github.com/tuoro/Smart-bill-manager.git
cd Smart-bill-manager
```

2. **å®‰è£…åç«¯ä¾èµ–å¹¶è¿è¡Œ**
```bash
cd backend-go
go mod download
go run ./cmd/server
```

3. **å®‰è£…å‰ç«¯ä¾èµ–**
```bash
cd ../frontend
npm install
```

4. **å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨**
```bash
npm run dev
```

5. **è®¿é—®åº”ç”¨**
æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:5173

## ğŸ“§ QQé‚®ç®±é…ç½®è¯´æ˜

1. ç™»å½•QQé‚®ç®±ç½‘é¡µç‰ˆ
2. è¿›å…¥ã€Œè®¾ç½®ã€â†’ã€Œè´¦æˆ·ã€
3. æ‰¾åˆ°ã€ŒIMAP/SMTPæœåŠ¡ã€å¹¶å¼€å¯
4. ç‚¹å‡»ã€Œç”Ÿæˆæˆæƒç ã€
5. åœ¨ç³»ç»Ÿä¸­æ·»åŠ é‚®ç®±é…ç½®ï¼š
   - é‚®ç®±åœ°å€ï¼šä½ çš„QQé‚®ç®±
   - IMAPæœåŠ¡å™¨ï¼šimap.qq.com
   - ç«¯å£ï¼š993
   - å¯†ç ï¼š**ä½¿ç”¨æˆæƒç ï¼Œä¸æ˜¯QQå¯†ç **

## ğŸ“ é¡¹ç›®ç»“æ„

```
Smart-bill-manager/
â”œâ”€â”€ backend-go/                  # Go åç«¯
â”‚   â”œâ”€â”€ cmd/server/main.go       # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”œâ”€â”€ config/              # é…ç½®
â”‚   â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ handlers/            # HTTP æ¥å£
â”‚   â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘ï¼ˆOCR/æ”¯ä»˜/å‘ç¥¨/è¡Œç¨‹ç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ middleware/          # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ repository/          # æ•°æ®è®¿é—®
â”‚   â”‚   â””â”€â”€ utils/               # å·¥å…·
â”‚   â”œâ”€â”€ pkg/database/            # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ go.mod / go.sum
â”‚   â””â”€â”€ ...
â”œâ”€â”€ frontend/                    # Vue å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.ts / App.vue    # å…¥å£ä¸æ ¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ router/              # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ stores/              # Pinia
â”‚   â”‚   â”œâ”€â”€ views/               # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ components/          # å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ api/                 # API å°è£…
â”‚   â”‚   â””â”€â”€ types/               # TS ç±»å‹
â”‚   â”œâ”€â”€ public/                  # é™æ€èµ„æº
â”‚   â”œâ”€â”€ Dockerfile / nginx.conf  # å‰ç«¯ç‹¬ç«‹éƒ¨ç½²
â”‚   â””â”€â”€ ...
â”œâ”€â”€ scripts/                     # è¾…åŠ©è„šæœ¬
â”‚   â”œâ”€â”€ ocr_cli.py               # è°ƒç”¨ RapidOCRï¼ˆå«æ¨¡å‹è‡ªåŠ¨ä¸‹è½½/æ ¡éªŒï¼‰
â”‚   â”œâ”€â”€ pdf_text_cli.py          # PDF æ–‡æœ¬æå–è°ƒè¯•
â”‚   â””â”€â”€ install_ocr.sh           # OCR ä¾èµ–å®‰è£…è„šæœ¬
â”œâ”€â”€ default_models.yaml          # RapidOCR é»˜è®¤æ¨¡å‹åˆ—è¡¨ï¼ˆå«å“ˆå¸Œæ ¡éªŒï¼‰
â”œâ”€â”€ Dockerfile                   # å‰åç«¯ç»Ÿä¸€é•œåƒ
â”œâ”€â”€ docker-compose.yml           # Compose éƒ¨ç½²
â”œâ”€â”€ nginx.conf                   # ç»Ÿä¸€ Nginx é…ç½®
â”œâ”€â”€ supervisord.conf             # è¿›ç¨‹ç®¡ç†é…ç½®
â””â”€â”€ README.md
```

## ğŸ”‘ API æ¥å£

### æ”¯ä»˜è®°å½•
- `GET /api/payments` - è·å–æ”¯ä»˜è®°å½•åˆ—è¡¨
- `GET /api/payments/stats` - è·å–ç»Ÿè®¡æ•°æ®
- `GET /api/payments/:id` - è·å–æ”¯ä»˜è®°å½•è¯¦æƒ…
- `GET /api/payments/:id/invoices` - **ğŸ†• è·å–å…³è”çš„å‘ç¥¨åˆ—è¡¨** âœ¨
- `POST /api/payments` - åˆ›å»ºæ”¯ä»˜è®°å½•
- `POST /api/payments/upload-screenshot` - **ğŸ†• ä¸Šä¼ æ”¯ä»˜æˆªå›¾å¹¶OCRè¯†åˆ«** âœ¨ï¼ˆè¿”å›è‰ç¨¿ `payment` + `extracted` + `dedup`ï¼‰
- `POST /api/payments/upload-screenshot/cancel` - å–æ¶ˆä¸Šä¼ ï¼ˆåˆ é™¤è‰ç¨¿æ–‡ä»¶ï¼‰
- `PUT /api/payments/:id` - æ›´æ–°æ”¯ä»˜è®°å½•ï¼ˆ`confirm=true` ç¡®è®¤ä¿å­˜ï¼›`force_duplicate_save=true` å¼ºåˆ¶ä¿å­˜ç–‘ä¼¼é‡å¤ï¼‰
- `DELETE /api/payments/:id` - åˆ é™¤æ”¯ä»˜è®°å½•

### å‘ç¥¨ç®¡ç†
- `GET /api/invoices` - è·å–å‘ç¥¨åˆ—è¡¨
- `GET /api/invoices/:id` - è·å–å‘ç¥¨è¯¦æƒ…
- `GET /api/invoices/:id/download` - ä¸‹è½½åŸæ–‡ä»¶
- `GET /api/invoices/:id/linked-payments` - **ğŸ†• è·å–å…³è”çš„æ”¯ä»˜è®°å½•** âœ¨
- `GET /api/invoices/:id/suggest-payments` - **ğŸ†• æ™ºèƒ½åŒ¹é…æ”¯ä»˜è®°å½•å»ºè®®** âœ¨
- `POST /api/invoices/upload` - ä¸Šä¼ å‘ç¥¨ï¼ˆè‡ªåŠ¨OCRè¯†åˆ«ï¼Œè¿”å›è‰ç¨¿ `invoice` + `dedup`ï¼‰
- `POST /api/invoices/upload-multiple` - æ‰¹é‡ä¸Šä¼ 
- `POST /api/invoices/:id/link-payment` - **ğŸ†• å…³è”å‘ç¥¨åˆ°æ”¯ä»˜è®°å½•** âœ¨
- `POST /api/invoices/:id/parse` - é‡æ–°è§£æ OCR/PDF
- `PUT /api/invoices/:id` - æ›´æ–°å‘ç¥¨ï¼ˆ`confirm=true` ç¡®è®¤ä¿å­˜ï¼›`force_duplicate_save=true` å¼ºåˆ¶ä¿å­˜ç–‘ä¼¼é‡å¤ï¼‰
- `DELETE /api/invoices/:id` - åˆ é™¤å‘ç¥¨
- `DELETE /api/invoices/:id/unlink-payment` - **ğŸ†• å–æ¶ˆå…³è”** âœ¨

### é‚®ç®±é…ç½®
- `GET /api/email/configs` - è·å–é‚®ç®±é…ç½®
- `POST /api/email/configs` - æ·»åŠ é‚®ç®±é…ç½®
- `POST /api/email/test` - æµ‹è¯•è¿æ¥
- `POST /api/email/monitor/start/:id` - å¯åŠ¨ç›‘æ§
- `POST /api/email/monitor/stop/:id` - åœæ­¢ç›‘æ§
- `POST /api/email/check/:id` - æ‰‹åŠ¨æ£€æŸ¥é‚®ä»¶

## ğŸ“¸ ç•Œé¢é¢„è§ˆ

ç³»ç»Ÿæä¾›ç¾è§‚çš„å¯è§†åŒ–ç•Œé¢ï¼ŒåŒ…æ‹¬ï¼š

1. **ä»ªè¡¨ç›˜** - æ•°æ®æ¦‚è§ˆï¼Œæ”¯å‡ºè¶‹åŠ¿å›¾è¡¨
2. **æ”¯ä»˜è®°å½•** - è¡¨æ ¼å±•ç¤ºï¼Œæ”¯æŒç­›é€‰å’Œç»Ÿè®¡
3. **å‘ç¥¨ç®¡ç†** - æ‹–æ‹½ä¸Šä¼ ï¼Œè‡ªåŠ¨è§£æ
4. **é‚®ç®±ç›‘æ§** - é…ç½®ç®¡ç†ï¼Œå®æ—¶çŠ¶æ€

## ğŸ“š æ–‡æ¡£

æœ¬æ–‡æ¡£å·²åŒ…å«æ—¥å¸¸ä½¿ç”¨æ‰€éœ€çš„ä¸»è¦è¯´æ˜ã€‚

## ğŸ“ License

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶
